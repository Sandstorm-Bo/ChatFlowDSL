name: "å”®å‰äº§å“å’¨è¯¢æµç¨‹"
entry_point: "state_start_inquiry"

states:
  - id: "state_start_inquiry"
    triggers:
      - type: regex
        value: ".*(äº†è§£|ä»‹ç»|å’¨è¯¢|çœ‹çœ‹|æ¨è).*(äº§å“|å•†å“).*"
    actions:
      # ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è·å–æ‰€æœ‰äº§å“åˆ—è¡¨
      - type: api_call
        endpoint: "database://products/list"
        params:
          limit: 5
        save_to: "session.featured_products"
      - type: respond
        text: |
          æ‚¨å¥½ï¼æ¬¢è¿äº†è§£æˆ‘ä»¬çš„äº§å“ã€‚æˆ‘ä»¬æœ‰ä»¥ä¸‹å•†å“ï¼š
          {{session.products_list}}

          è¯·å‘Šè¯‰æˆ‘æ‚¨å¯¹å“ªæ¬¾äº§å“æ„Ÿå…´è¶£ï¼Œæˆ–è€…ç›´æ¥è¯´å‡ºäº§å“åç§°ã€‚
    transitions:
      - target: "state_collect_product_choice"

  - id: "state_collect_product_choice"
    actions:
      - type: wait_for_input
    transitions:
      # è€³æœºç›¸å…³
      - condition:
          all:
            - type: regex
              value: ".*(è€³æœº|headset|è“ç‰™).*"
        target: "state_show_product_P001"
      # æ‰‹ç¯ç›¸å…³
      - condition:
          all:
            - type: regex
              value: ".*(æ‰‹ç¯|band|æ™ºèƒ½ç©¿æˆ´).*"
        target: "state_show_product_P002"
      # å……ç”µå®ç›¸å…³
      - condition:
          all:
            - type: regex
              value: ".*(å……ç”µå®|ç§»åŠ¨ç”µæº|power.*bank).*"
        target: "state_show_product_P003"
      # é”®ç›˜ç›¸å…³
      - condition:
          all:
            - type: regex
              value: ".*(é”®ç›˜|keyboard|æœºæ¢°é”®ç›˜).*"
        target: "state_show_product_P004"
      # æ‘„åƒå¤´ç›¸å…³
      - condition:
          all:
            - type: regex
              value: ".*(æ‘„åƒå¤´|webcam|camera).*"
        target: "state_show_product_P005"
      - target: "state_product_search"

  # å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œå°è¯•æœç´¢
  - id: "state_product_search"
    actions:
      - type: set_variable
        scope: session
        key: "search_keyword"
        value: "{{session.last_user_input}}"
      - type: api_call
        endpoint: "database://products/search"
        params:
          keyword: "{{session.search_keyword}}"
        save_to: "session.search_results"
      - type: respond
        text: |
          è®©æˆ‘ä¸ºæ‚¨æœç´¢ä¸€ä¸‹...
          {{session.search_result_text}}
    transitions:
      - target: "state_end_inquiry"

  # å±•ç¤ºå…·ä½“äº§å“ - P001 æ— çº¿è“ç‰™è€³æœºPro
  - id: "state_show_product_P001"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P001"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æ— çº¿è“ç‰™è€³æœºProã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          äº§å“ç‰¹ç‚¹ï¼š
          {{session.current_product.features}}

          äº§å“æè¿°ï¼š
          {{session.current_product.description}}

          æ‚¨æƒ³äº†è§£æ›´å¤šè¯¦æƒ…è¿˜æ˜¯ç›´æ¥è´­ä¹°å‘¢ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(çœ‹çœ‹|äº†è§£|å…¶ä»–|è¿˜æœ‰).*"
        target: "state_start_inquiry"
      - target: "state_end_inquiry"

  # å±•ç¤ºå…·ä½“äº§å“ - P002 æ™ºèƒ½æ‰‹ç¯Max
  - id: "state_show_product_P002"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P002"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æ™ºèƒ½æ‰‹ç¯Maxã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          æ‚¨æƒ³äº†è§£æ›´å¤šè¯¦æƒ…è¿˜æ˜¯ç›´æ¥è´­ä¹°å‘¢ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦).*"
        target: "state_confirm_purchase"
      - target: "state_end_inquiry"

  # å±•ç¤ºå…·ä½“äº§å“ - P003 å……ç”µå®
  - id: "state_show_product_P003"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P003"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€ä¾¿æºå……ç”µå®20000mAhã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          å¤§å®¹é‡ï¼Œéšæ—¶éšåœ°ä¸ºæ‚¨çš„è®¾å¤‡å……ç”µï¼æƒ³è´­ä¹°å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦).*"
        target: "state_confirm_purchase"
      - target: "state_end_inquiry"

  # å±•ç¤ºå…·ä½“äº§å“ - P004 æœºæ¢°é”®ç›˜
  - id: "state_show_product_P004"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P004"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æœºæ¢°é”®ç›˜RGBç‰ˆã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          æ¸¸æˆåŠå…¬ä¸¤ç›¸å®œï¼Œæƒ³è¯•è¯•å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦).*"
        target: "state_confirm_purchase"
      - target: "state_end_inquiry"

  # å±•ç¤ºå…·ä½“äº§å“ - P005 æ‘„åƒå¤´
  - id: "state_show_product_P005"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P005"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€4Kç½‘ç»œæ‘„åƒå¤´ã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          é«˜æ¸…è§†é¢‘ä¼šè®®å¿…å¤‡ï¼éœ€è¦è´­ä¹°å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦).*"
        target: "state_confirm_purchase"
      - target: "state_end_inquiry"

  # ç¡®è®¤è´­ä¹°
  - id: "state_confirm_purchase"
    actions:
      - type: respond
        text: |
          å¥½çš„ï¼æ‚¨æƒ³è´­ä¹°ã€{{session.current_product.name}}ã€‘
          å•ä»·ï¼šÂ¥{{session.current_product.price}}

          ç”±äºè¿™æ˜¯æ¼”ç¤ºç³»ç»Ÿï¼Œå®é™…è´­ä¹°æµç¨‹éœ€è¦è·³è½¬åˆ°è®¢å•ç³»ç»Ÿã€‚
          æ‚¨å¯ä»¥è¯´"æŸ¥çœ‹æˆ‘çš„è®¢å•"æ¥æŸ¥çœ‹å·²æœ‰è®¢å•çŠ¶æ€ã€‚

          è¿˜æœ‰å…¶ä»–éœ€è¦äº†è§£çš„å—ï¼Ÿ
    transitions:
      - target: "state_end_inquiry"

  - id: "state_end_inquiry"
    actions:
      - type: respond
        text: "å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥é—®æˆ‘ã€‚ç¥æ‚¨è´­ç‰©æ„‰å¿«ï¼"
