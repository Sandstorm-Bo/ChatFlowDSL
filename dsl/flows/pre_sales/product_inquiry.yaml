name: "å”®å‰äº§å“å’¨è¯¢æµç¨‹"
entry_point: "state_start_inquiry"

states:
  - id: "state_start_inquiry"
    triggers:
      - type: regex
        value: ".*(äº†è§£|ä»‹ç»|å’¨è¯¢|çœ‹çœ‹|æ¨è).*(äº§å“|å•†å“).*"
      - type: regex
        value: ".*(å•†å“|äº§å“).*ä¿¡æ¯.*"
      - type: regex
        value: ".*(ä¹°|è´­ä¹°|ä¸‹å•).*(è€³æœº|å•†å“|äº§å“).*"
      - type: regex
        value: ".*(æƒ³ä¹°|æƒ³ä¸‹å•|æƒ³è¦).*(è€³æœº|å•†å“|äº§å“).*"
      - type: regex
        value: ".*(è€³æœº|å•†å“|äº§å“).*(æ€ä¹ˆæ ·|å¥½ä¸å¥½|è¡Œä¸è¡Œ|æ¨èä¸€ä¸‹|æ¨èä¸‹|æ¨èä¸€ä¸ª).*"
      - type: regex
        value: ".*æœ‰.*(è€³æœº|å•†å“|äº§å“).*(æ¨è|åˆé€‚|é€‚åˆ).*"
    actions:
      - type: api_call
        endpoint: "database://products/list"
        params:
          limit: 5
        save_to: "session.featured_products"
      - type: respond
        text: |
          æ‚¨å¥½ï¼æ¬¢è¿äº†è§£æˆ‘ä»¬çš„äº§å“ã€‚æˆ‘ä»¬æœ‰ä»¥ä¸‹å•†å“ï¼š
          {{session.products_list}}

          è¯·å‘Šè¯‰æˆ‘æ‚¨å¯¹å“ªæ¬¾äº§å“æ„Ÿå…´è¶£ï¼Œæˆ–è€…ç›´æ¥è¯´å‡ºäº§å“åç§°ã€‚
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è€³æœº|headset|è“ç‰™).*"
        target: "state_show_product_P001"
      - condition:
          all:
            - type: regex
              value: ".*(æ‰‹ç¯|band|æ™ºèƒ½ç©¿æˆ´).*"
        target: "state_show_product_P002"
      - condition:
          all:
            - type: regex
              value: ".*(å……ç”µå®|ç§»åŠ¨ç”µæº|power.*bank).*"
        target: "state_show_product_P003"
      - condition:
          all:
            - type: regex
              value: ".*(é”®ç›˜|keyboard|æœºæ¢°é”®ç›˜).*"
        target: "state_show_product_P004"
      - condition:
          all:
            - type: regex
              value: ".*(æ‘„åƒå¤´|webcam|camera).*"
        target: "state_show_product_P005"
      - target: "state_product_search"

  - id: "state_product_search"
    actions:
      - type: extract_variable
        source: user_input
        regex: "(?P<keyword>.+)"
        target: "session.keyword"
      - type: api_call
        endpoint: "database://products/search"
        params:
          keyword: "{{session.keyword}}"
        save_to: "session.search_results"
      - type: respond
        text: |
          è®©æˆ‘ä¸ºæ‚¨æœç´¢ä¸€ä¸‹â€¦
          {{session.search_result_text}}

          å¦‚æœæ‚¨æƒ³äº†è§£å…¶ä¸­æŸæ¬¾ï¼Œè¯·ç›´æ¥è¯´å‡ºå•†å“åç§°ï¼Œ
          ä¾‹å¦‚â€œå¹³æ¿ç”µè„‘ 12â€ï¼›ä¹Ÿå¯ä»¥è¯´â€œç¬¬ä¸€ä¸ª/ç¬¬äºŒä¸ªâ€æˆ–â€œä»·æ ¼æ˜¯ 2419 çš„é‚£æ¬¾â€ã€‚
          è‹¥æ²¡æ‰¾åˆ°åˆé€‚çš„ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘æ–°çš„å…³é”®è¯ï¼Œæˆ‘å†å¸®æ‚¨æŸ¥ã€‚
    transitions:
      # æœç´¢å®Œæˆåï¼Œä¸‹ä¸€è½®ç”¨æˆ·è¾“å…¥ç›´æ¥ç”¨äºåœ¨å½“å‰ç»“æœä¸­é€‰ä¸­å…·ä½“å•†å“
      - target: "state_select_from_results"

  - id: "state_select_from_results"
    actions:
      - type: select_product_from_results
    transitions:
      - condition:
          all:
            - type: variable_equals
              variable: "product_selected"
              value: true
        target: "state_show_current_product"
      - condition:
          all:
            - type: regex
              value: ".*(å…¶ä»–|æ¢ä¸€ä¸ª|å†çœ‹çœ‹|æ¢æ¬¾|æ¢ä¸€ç§).*"
        target: "state_start_inquiry"
      - target: "state_product_search"

  - id: "state_show_current_product"
    actions:
      - type: respond
        text: |
          ã€{{session.current_product.name}}ã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          äº§å“ç‰¹ç‚¹ï¼š
          {{session.current_product.features}}

          äº§å“æè¿°ï¼š
          {{session.current_product.description}}

          å¦‚æœæ‚¨æƒ³è´­ä¹°ï¼Œå¯ä»¥ç›´æ¥è¯´â€œä¹°è¿™æ¬¾â€æˆ–â€œä¸‹å•â€ï¼›å¦‚æœæƒ³å†äº†è§£åˆ«çš„äº§å“ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘æ–°çš„éœ€æ±‚ã€‚
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª|ä¹°è¿™æ¬¾).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(å…¶ä»–|æ¢ä¸€ä¸ª|å†çœ‹çœ‹|æ¢æ¬¾|æ¢ä¸€ç§).*"
        target: "state_start_inquiry"
      - target: "state_end_inquiry"

  - id: "state_show_product_P001"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P001"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æ— çº¿è“ç‰™è€³æœºProã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          äº§å“ç‰¹ç‚¹ï¼š
          {{session.current_product.features}}

          äº§å“æè¿°ï¼š
          {{session.current_product.description}}

          æ‚¨æƒ³äº†è§£æ›´å¤šè¯¦æƒ…è¿˜æ˜¯ç›´æ¥è´­ä¹°å‘¢ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(çœ‹çœ‹|äº†è§£|å…¶ä»–|è¿˜æœ‰|æ›´å¤š|è¯¦ç»†|ä¿ä¿®|è´¨ä¿|å”®å|æ´»åŠ¨|ä¼˜æƒ |æŠ˜æ‰£|é”€é‡).*"
        target: "state_product_more_info"
      - condition:
          all:
            - type: regex
              value: ".*(çœ‹çœ‹|äº†è§£|å…¶ä»–|è¿˜æœ‰).*"
        target: "state_start_inquiry"
      - target: "state_end_inquiry"

  - id: "state_show_product_P002"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P002"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æ™ºèƒ½æ‰‹ç¯Maxã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          æ‚¨æƒ³äº†è§£æ›´å¤šè¯¦æƒ…è¿˜æ˜¯ç›´æ¥è´­ä¹°å‘¢ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(æ›´å¤š|è¯¦ç»†|ä¿ä¿®|è´¨ä¿|å”®å|æ´»åŠ¨|ä¼˜æƒ |æŠ˜æ‰£|é”€é‡).*"
        target: "state_product_more_info"
      - target: "state_end_inquiry"

  - id: "state_show_product_P003"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P003"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€ä¾¿æºå……ç”µå®20000mAhã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          å¤§å®¹é‡ï¼Œéšæ—¶éšåœ°ä¸ºæ‚¨çš„è®¾å¤‡å……ç”µï¼æƒ³è´­ä¹°å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(æ›´å¤š|è¯¦ç»†|ä¿ä¿®|è´¨ä¿|å”®å|æ´»åŠ¨|ä¼˜æƒ |æŠ˜æ‰£|é”€é‡).*"
        target: "state_product_more_info"
      - target: "state_end_inquiry"

  - id: "state_show_product_P004"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P004"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€æœºæ¢°é”®ç›˜RGBç‰ˆã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          æ¸¸æˆåŠå…¬ä¸¤ç›¸å®œï¼Œæƒ³è¯•è¯•å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(æ›´å¤š|è¯¦ç»†|ä¿ä¿®|è´¨ä¿|å”®å|æ´»åŠ¨|ä¼˜æƒ |æŠ˜æ‰£|é”€é‡).*"
        target: "state_product_more_info"
      - target: "state_end_inquiry"

  - id: "state_show_product_P005"
    actions:
      - type: api_call
        endpoint: "database://products/get"
        params:
          product_id: "P005"
        save_to: "session.current_product"
      - type: respond
        text: |
          ã€4Kç½‘ç»œæ‘„åƒå¤´ã€‘
          ğŸ’° ä»·æ ¼ï¼šÂ¥{{session.current_product.price}}
          ğŸ“¦ åº“å­˜ï¼š{{session.current_product.stock}} ä»¶

          {{session.current_product.description}}

          é«˜æ¸…è§†é¢‘ä¼šè®®å¿…å¤‡ï¼éœ€è¦è´­ä¹°å—ï¼Ÿ
    transitions:
      - condition:
          all:
            - type: regex
              value: ".*(è´­ä¹°|ä¸‹å•|ä¹°|è¦|å…¥æ‰‹|æ¥ä¸€ä¸ª|æ¥ä¸€å°|æ•´ä¸€ä¸ª).*"
        target: "state_confirm_purchase"
      - condition:
          all:
            - type: regex
              value: ".*(æ›´å¤š|è¯¦ç»†|ä¿ä¿®|è´¨ä¿|å”®å|æ´»åŠ¨|ä¼˜æƒ |æŠ˜æ‰£|é”€é‡).*"
        target: "state_product_more_info"
      - target: "state_end_inquiry"

  - id: "state_product_more_info"
    actions:
      - type: respond
        text: |
          å…³äºã€{{session.current_product.name}}ã€‘çš„æ›´å¤šä¿¡æ¯ï¼š
          - ä¿ä¿®ä¸å”®åï¼šæœ¬äº§å“äº«å—å›½å®¶è§„å®šçš„â€œä¸‰åŒ…â€æœåŠ¡ï¼Œå…·ä½“ä¿ä¿®æœŸé™å’Œæ”¿ç­–è¯·ä»¥å®é™…è´­ä¹°é¡µé¢å’Œå‘ç¥¨ä¿¡æ¯ä¸ºå‡†ï¼›
          - ä½¿ç”¨ä¸æ³¨æ„äº‹é¡¹ï¼šå¦‚é‡è´¨é‡é—®é¢˜ï¼Œå¯åœ¨è§„å®šæ—¶é—´å†…ç”³è¯·å”®åæœåŠ¡ï¼›
          - æ´»åŠ¨ä¸ä¼˜æƒ ï¼šå¦‚æœ‰æ»¡å‡æˆ–ä¼˜æƒ æ´»åŠ¨ï¼Œä»¥å½“å‰ä¸‹å•é¡µå±•ç¤ºä¸ºå‡†ã€‚

          å¦‚æœæ‚¨è¿˜æœ‰æ›´å…·ä½“çš„é—®é¢˜ï¼ˆä¾‹å¦‚æŸä¸ªåŠŸèƒ½æ˜¯å¦æ”¯æŒï¼‰ï¼Œå¯ä»¥ç»§ç»­è¯¦ç»†æè¿°ï¼›å¦‚æœå·²ç»å†³å®šè´­ä¹°ï¼Œå¯ä»¥ç›´æ¥è¯´â€œä¹°è¿™æ¬¾â€æˆ–â€œä¸‹å•â€ã€‚ 
    transitions:
      - target: "state_end_inquiry"

  - id: "state_confirm_purchase"
    actions:
      - type: api_call
        endpoint: "database://orders/create"
        params:
          product_id: "{{session.current_product.product_id}}"
          quantity: 1
          shipping_address: "{{session.shipping_address}}"
        save_to: "session.new_order"
      - type: respond
        text: |
          å¥½çš„ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè®¢å•ç¼–å·ï¼š{{session.new_order.order_id}}
          å•†å“ï¼š{{session.new_order.product_name}}
          è®¢å•æ€»ä»·ï¼šÂ¥{{session.new_order.total_price}}

          è¯·æ³¨æ„ï¼šè¿™æ˜¯æ¨¡æ‹Ÿè®¢å•ï¼Œç‰©æµåç»­å°†åœ¨è®¢å•ç®¡ç†æµç¨‹ä¸­æŸ¥è¯¢ã€‚
    transitions:
      - target: "state_end_inquiry"

  - id: "state_end_inquiry"
    actions:
      - type: respond
        text: "å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥é—®æˆ‘ã€‚ç¥æ‚¨è´­ç‰©æ„‰å¿«ï¼"
    transitions:
      # å¦‚æœå½“å‰ä¼šè¯ä¸­å·²ç»æœ‰é€‰ä¸­çš„å•†å“ï¼Œå¹¶ä¸”ç”¨æˆ·è¡¨è¾¾äº†è´­ä¹°æ„å›¾ï¼Œåˆ™ç›´æ¥è¿›å…¥è´­ä¹°ç¡®è®¤
      - condition:
          all:
            - type: variable_exists
              variable: "current_product"
            - type: regex
              value: ".*(ä¹°|è´­ä¹°|ä¸‹å•|è¦).*"
        target: "state_confirm_purchase"
      # å¦‚æœç”¨æˆ·ç»§ç»­æåˆ°å•†å“/äº§å“ç›¸å…³å†…å®¹ï¼Œåˆ™å›åˆ°å”®å‰å…¥å£ï¼Œé‡æ–°è¿›å…¥äº§å“å’¨è¯¢æµç¨‹
      - condition:
          all:
            - type: regex
              value: ".*(å•†å“|äº§å“|è€³æœº|æ‰‹ç¯|å……ç”µå®|é”®ç›˜|æ‘„åƒå¤´).*"
        target: "state_start_inquiry"
      # å…œåº•ï¼šå…¶ä»–ä»»æ„è¾“å…¥ä¹Ÿå›åˆ°å”®å‰å…¥å£ï¼Œç”±å…¥å£é‡æ–°åˆ†å‘
      - target: "state_start_inquiry"
